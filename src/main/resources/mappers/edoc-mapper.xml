<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "mybatis-3-mapper.dtd" >
<mapper namespace="edocMapper">

	<resultMap id="edocSampleResultMap" type="EDocSampleDto">
		<result column="sample_no" property="sampleNo" />
		<result column="sample_dot_code" property="sampleDotCode" />
		<result column="sample_desc" property="sampleDesc" />
		<result column="sample_format" property="sampleFormat" />
		<result column="emp_no" property="empNo" />
		<result column="create_date" property="createDt" />
		<result column="modifier" property="modyfy" />
		<result column="modify_date" property="modifyDt" />
		<result column="use_yn" property="useYN" />
	</resultMap>
	
	<resultMap id="departmentResultMap" type="DepartmentDto">
		<result column="dept_code" property="deptCode" />
		<result column="dept_upstair" property="deptUpStair" />
		<result column="dept_name" property="deptName" /> 
		<result column="emp_no" property="empNo" />
		<result column="create_date" property="createDate" />
		<result column="modifier" property="modifier" />
		<result column="modify_date" property="modifyDate" />	
		<result column="use_yn" property="useYN" />	
	</resultMap>
	
	<resultMap id="empMemberResultMap" type="EmpMemberDto">
		<result column="EMP_NO" property="empNo"/>
		<result column="EMP_NAME" property="empName"/>
		<result column="EMP_GENDER" property="empGender"/>
		<result column="EMP_BIRTH" property="empBirth"/>
		<result column="EMP_PHONE" property="empPhone"/>
		<result column="EMP_EMAIL" property="empEmail"/>
		<result column="EMP_ADDRESS" property="empAddress"/>
		<result column="EMP_EMPLOYMENT" property="empEmployment"/>
		<result column="EMP_DETAILADDRESS" property="empDetailAddress"/>
		<result column="EMP_POSTCODE" property="empPostcode"/>
		<result column="EMP_PASSWORD" property="empPwd"/>
		<result column="EMP_AUTH" property="empAuth"/>
		<result column="EMP_RANK" property="empRank"/>
		<result column="EMP_PROFILE" property="empProfile"/>
		<result column="DEPT_CODE" property="deptCode"/>
		<result column="CREATE_DATE" property="createDate"/>
		<result column="MODIFY_DATE" property="modifyDate"/>
		<result column="CREATER" property="creater"/>
		<result column="MODIFIER" property="modifier"/>
		<result column="USE_YN" property="useYn"/>
		<result column="AC_NO" property="acNo"/>
		<result column="AC_BANK" property="acBank"/>	
		 <!-- CommonCode 테이블에서 가져온 nm 컬럼 -->
    <result property="nm" column="nm"/>
    
    <!-- Department 테이블에서 가져온 dept_upstair, dept_name 컬럼 -->
    <result property="deptUpStair" column="dept_upstair"/>
    <result property="deptName" column="dept_name"/>
	</resultMap>
		
	
	<!-- 전자결재 양식관리 -->
	<!-- 양식 목록 조회(페이징) -->
	<select id="selectEDocSampleListCount" resultType="_int">
		select
					count(*)
		 from
		 			tbl_edoc_sample
		where use_yn = 'Y'
	</select>
	
	<!-- 양식 목록 조회 -->
	<select id="selectEDocSampleList" resultMap="edocSampleResultMap">
		select 
					sample_no
				, sample_dot_code
				, sample_desc
				, emp_no
				, to_char(create_date, 'YYYY-MM-DD') create_date
	 	 from 
	 	 			tbl_edoc_sample
		where	use_yn = 'Y'
		order by sample_no desc					
	</select>
	
	<!-- 양식 등록 -->
	<insert id="insertEDocSample">
		insert
			into tbl_edoc_sample
			(
				sample_no
			, sample_dot_code
			, sample_desc
			, sample_format
			, emp_no
			, create_date
			)
			values
			(
				sample_no_seq.nextval
			,	#{sampleDotCode}
			,	#{sampleDesc}
			,	#{sampleFormat}
			,	#{empNo}
			,	SYSDATE	
			)
	</insert>
	
	<!-- 양식 삭제 -->
	<update id="deleteEdocSample">
		update
			 		tbl_edoc_sample
			set use_yn = 'n'
			 		
		<where>
        <foreach item="deleteNo" collection="array" 
        				 open="sample_no in (" separator="," close=")">
            #{deleteNo}
        </foreach>
		</where>
	</update>
	
	<!-- 전자결재 양식관리 -->
	
	
	
	
	<!-- 기안서 작성 -->
	<!-- 양식유형만 조회 --> 
	<select id="selectEDocFormList" resultMap="edocSampleResultMap">
		select 
					sample_no, 
					sample_dot_code 
		  from 
		 			tbl_edoc_sample
		where	use_yn = 'Y'
	</select>
	
	<!-- 양식유형 선택후 양식을 가져오기 -->
	<select id="selectEDocForm" resultMap="edocSampleResultMap">
		select 
					sample_no, 
					sample_format
		  from 
		 			tbl_edoc_sample
		where	sample_no = #{sampleNoInt}
	</select>

	<!-- jstree 담을 부서 데이터 -->
	<select id="selectDepartments" resultMap="departmentResultMap">
		select 
					dept_code
				, dept_upstair
				, dept_name
		  from 
					tbl_department
		where use_yn = 'Y'
	</select>
	
	<!-- jstree 담을 직원 데이터 -->
	<select id="selectEmployees" resultMap="empMemberResultMap">
		select a.*, rownum as CREATER from (
			(SELECT t1.DEPT_CODE as EMP_NO , t1.DEPT_NAME as EMP_NAME, LEVEL as AC_BANK, NVL(t1.DEPT_UPSTAIR, '#') as DEPT_CODE, 'dept' as EMP_GENDER
			FROM (SELECT *
				  FROM TBL_DEPARTMENT
				  WHERE USE_YN = 'Y') t1
			START WITH t1.DEPT_UPSTAIR is null
			CONNECT BY PRIOR t1.DEPT_CODE = t1.DEPT_UPSTAIR)

			union all

			(select
				''||emp.emp_no as EMP_NO,
				emp.emp_name as EMP_NAME,
				9 as AC_BANK,
				emp.dept_code as DEPT_CODE,
				'emp' as EMP_GENDER
			from
				tbl_employee emp
			where
				emp.use_yn = 'Y'
				and emp.emp_name != '정준수')
		) a
	</select>
	
	


</mapper>

